<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
 <title>Gradebook Module</title>
 <!-- for MSIE 10 on Windows 8 -->
 <meta http-equiv="X-UA-Compatible" content="requiresActiveX=true"/>
 <link rel="stylesheet" href="http://web.mit.edu/music21/music21j/css/m21theory.css" type="text/css" />
 <meta http-equiv="content-type" content="text/html; charset=utf-8" />
 <script data-main="../../src/m21theory" src="../../ext/require/require.js"></script>
</head>
<body>
<script type="text/javascript">
require(['m21theory'], function() {
    m21theory.style.apply({loadCss: false});
    
    m21theory.userData.fillNameDiv();
    
    var serverSettings = m21theory.serverSettings;
    var ajax = function (func, successCall, funcParams) {
        var jsonObj = music21.common.merge({
            function: func,
        }, funcParams);
        var params = { 
                url: serverSettings.gradebookUrl, 
                success: successCall,
            }
        
        serverSettings.makeAjax(jsonObj, params);
    }
    var $bb = $('.body#testBank');
        
    
    var $commands = $("<ul></ul>");
    var $comments = $("<li><a href='#'>Get comments</a></li>").on('click', function () {
        ajax('getComments', handleComments);
    });
    
    
    $commands.append($comments);
    $bb.append($commands);
    var $commentsOut = $('<div id="comments"></div>');
    $bb.append($commentsOut);

    
    var handleComments = function (js) {
        if (js.error !== undefined && js.error !== null) {
            m21theory.feedback.alert(js.error, 'alert');
            return;
        }        
        $commentsOut.empty();
        $commentsOut.append($("<h1>Recent comments</h1>"));
        for (var i = 0; i < js.comments.length; i++) { 
            var jsc = js.comments[i];
            var $inDiv = $("<div></div>");
            var $h3 = $("<h3 style='width: 100%'></h3>");
            var $link = $("<a href='mailto:" + jsc.userInfo.email + "'></a>");
            $link.append($("<span>" + jsc.userInfo.first + " " + jsc.userInfo.last + "</span>"));
            $h3.append($link);
            $h3.append("<small> (" + jsc.userId + ") </small>")
            $h3.append($("<div style='float: right; font-size: 10pt'> " + m21theory.misc.niceTimestamp(jsc.lastUpdated) + " </div>"));
            $inDiv.append($h3);
            $inDiv.append($("<div style='float: right'><i>" + jsc.bankId + " " + jsc.sectionId + "</i></div>"));
            $inDiv.append($("<div>" + jsc.comment + "</div>"));
            $commentsOut.append($inDiv);   
        }    
    };

    
});

</script>
</body>
</html>